// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===== USER (Admin) =====

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // Hashed with bcrypt
  name      String
  role      String   @default("admin")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  posts     Post[]
}

// ===== BLOG POST =====

model Post {
  id               String        @id @default(cuid())
  title            String
  slug             String        @unique
  content          String        @db.Text
  excerpt          String?       @db.Text
  featuredImage    String?
  metaTitle        String?
  metaDescription  String?
  publishStatus    PublishStatus @default(DRAFT)
  publishAt        DateTime?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  authorId         String?
  author           User?         @relation(fields: [authorId], references: [id], onDelete: SetNull)
  categories       Category[]    @relation("PostCategories")
  tags             Tag[]         @relation("PostTags")

  @@index([slug])
  @@index([publishStatus])
  @@index([publishAt])
}

enum PublishStatus {
  DRAFT
  PUBLISHED
  SCHEDULED
}

// ===== CATEGORY =====

model Category {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?  @db.Text
  posts       Post[]   @relation("PostCategories")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
}

// ===== TAG =====

model Tag {
  id        String   @id @default(cuid())
  name      String
  slug      String   @unique
  posts     Post[]   @relation("PostTags")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
}

// ===== TREATMENT (Tratamientos dentales) =====

model Treatment {
  id               String   @id @default(cuid())
  title            String
  slug             String   @unique
  description      String   @db.Text
  longDescription  String?  @db.Text
  featuredImage    String?
  icon             String?
  priceRange       String?  // Ej: "800€ - 1.500€"
  duration         String?  // Ej: "1-2 sesiones"
  metaTitle        String?
  metaDescription  String?
  faqItems         Json?    // Array de {question, answer}
  order            Int      @default(0)
  published        Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([slug])
  @@index([published])
}

// ===== PAGE (Páginas estáticas editables) =====

model Page {
  id              String   @id @default(cuid())
  title           String
  slug            String   @unique
  content         String   @db.Text
  metaTitle       String?
  metaDescription String?
  published       Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([slug])
}

// ===== SETTINGS (Configuración global) =====

model Settings {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String   @db.Text
  description String?
  updatedAt   DateTime @updatedAt

  @@index([key])
}

// ===== CONTACT SUBMISSION (Formularios de contacto) =====

model ContactSubmission {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String
  message   String   @db.Text
  createdAt DateTime @default(now())
}

// ===== APPOINTMENT REQUEST (Solicitudes de cita) =====

model AppointmentRequest {
  id            String   @id @default(cuid())
  name          String
  email         String
  phone         String
  preferredDate String?
  preferredTime String?
  treatment     String?
  message       String?  @db.Text
  status        String   @default("pending") // pending, confirmed, cancelled
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
}


